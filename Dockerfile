FROM kalilinux/kali-rolling:latest as kali
WORKDIR /os
RUN apt-get update
RUN apt-get upgrade -y
RUN apt-get dist-upgrade -y
RUN apt-get install wget -y

FROM kali as go
RUN apt-get install golang -y
RUN go env -w GO111MODULE=auto
RUN go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
RUN mv /root/go/bin/subfinder /usr/bin/
RUN go install github.com/tomnomnom/assetfinder@latest
RUN mv /root/go/bin/assetfinder /usr/bin/

FROM go as npm
COPY package.json ./
RUN apt-get install node.js npm -y
RUN npm install -g pnpm
RUN pnpm install

FROM npm as base
COPY src/ ./src
COPY tsconfig* ./

FROM base as dev
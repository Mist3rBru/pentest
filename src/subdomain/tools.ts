import { exec } from '../utils'
import axios from 'axios'

export async function getGithubSubdomainList(
  domain: string
): Promise<string[]> {
  const { data: subdomainListResponse } = await axios.get<string>(
    'https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/DNS/subdomains-top1million-5000.txt',
    { validateStatus: () => true }
  )
  return subdomainListResponse
    .split('\n')
    .map(subdomain => `${subdomain}.${domain}`)
}

export async function getSubFinderSubdomainList(domain: string) {
  const result = await exec(`subfinder -d ${domain}`)
  return result.split('\n')
}

export async function getAssetFinderSubdomainList(
  domain: string
): Promise<string[]> {
  const result = await exec(`assetfinder -subs-only ${domain}`)
  return result.split('\n')
}

export async function nmapScan(ip: string) {
  const result = await exec(
    `nmap -Pn -sV -f -n -T 3 --data-length 127 --randomize-hosts ${ip}`
  )
  return result.split('\n')
}

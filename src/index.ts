import 'dotenv/config'
import { informationGathering, systemEnum } from './scripts'
import { formatDataFilePath, readFile } from './utils'
import { existsSync } from 'node:fs'

async function main(): Promise<void> {
  const domain = process.argv[2]

  const subdomainFile = `subdomain.data.${domain}.json` as const
  const informationGatheringResult = existsSync(
    formatDataFilePath(subdomainFile)
  )
    ? readFile(subdomainFile)
    : await informationGathering(domain)

  const systemEnumFile = `system.${domain}.json` as const
  const systemEnumResult = existsSync(formatDataFilePath(systemEnumFile))
    ? readFile(systemEnumFile)
    : await systemEnum(domain, Object.keys(informationGatheringResult))
}

main()
